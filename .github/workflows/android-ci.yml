      # Ask Gradle where :app's buildDir is and save it
      - name: Print :app properties (find buildDir)
        run: ./gradlew -q :app:properties | tee app-properties.txt

      - name: Show resolved buildDir and contents
        shell: bash
        run: |
          set -euo pipefail
          echo "Grepping buildDir from properties..."
          BUILD_DIR=$(grep -E '^buildDir:' app-properties.txt | awk '{print $2}')
          if [ -z "${BUILD_DIR:-}" ]; then
            echo "Could not find buildDir in app-properties.txt"; cat app-properties.txt; exit 0
          fi
          echo "Resolved buildDir => $BUILD_DIR"
          echo "Listing $BUILD_DIR:"
          ls -la "$BUILD_DIR" || true
          echo "Listing outputs under $BUILD_DIR/outputs:"
          ls -R "$BUILD_DIR/outputs" || true
          echo "Exporting for next steps"
          echo "APP_BUILD_DIR=$BUILD_DIR" >> $GITHUB_ENV

      # Upload from the exact buildDir Gradle reported
      - name: Upload artifacts from Gradle-reported buildDir
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: debug-artifacts-by-buildDir
          path: |
            ${{ env.APP_BUILD_DIR }}/outputs/bundle/debug/*.aab
            ${{ env.APP_BUILD_DIR }}/outputs/**/*.apk
            ${{ env.APP_BUILD_DIR }}/outputs/**/*.apks
          if-no-files-found: warn
          retention-days: 7
